unit test case documentation for esp
author: carolina chacin
updated: feb 23 2012

VAERS 
17 patients (7 NEG and 11 pos)	
(all encounters have to be in the non specialty site for urgent care--not urgent?)
1 patient with 1 encounter with a diagnostic in the list of VAERS_DIAGNOSTICS (bells) in rules.py -platU yes
       that has an ignore period 12 and category 2 
  same patient with 1 encounter with same diagnostic in the list of VAERS_DIAGNOSTICS 
     that has an ignore period 12 and that happened within the ignore period of above encounter (1 neg 1 pos)
  same patient with immunization 42 days prior to first dx 
1 patient with 1 encounter with a diagnostic in the list of VAERS_DIAGNOSTICS (seizures febrile ) -patri yes
       that does not have an ignore period  and category 2 
   same patient with immunization risk period days prior to dx 
1 patient with 1 encounter with a diagnostic in the list of VAERS_DIAGNOSTICS 682.3 category 3 -maryV yes
   same patient with immunization risk period days 30days prior to dx   
 1 patient with 1 encounter with a diagnostic in the list of VAERS_DIAGNOSTICS 003.23 category 4 -johnW  not triggering? code not in icd
   same patient with immunization risk period days  30 days prior to dx  
1 patient with 1 lab test in the list of VAERS_LAB_RESULTS alt >120 that meets the criteria of one defined in rules.py -whor yes
   that happened within risk period of vaccine, for category 2
  same patient with immunization 30 days prior to lab. 
1 patient with an immunization from table static.vaccine -klompasO yes
  same patient with 1 encounter with fever (temp > 100.4), and set to URGENT CARE this is category 1
  within TIME_WINDOW_POST_EVENT (within 7 days) immunization. 
1 patient with 1 encounter with a diagnostic in the list of VAERS_DIAGNOSTIc (guilian barre) (NEG)-kruskalT yes
  that has an ignore period 12 but not in the specialty clinic.  
  same patient with immunization within 42 days prior to dx
1 patient with two labs for hemoglobin within 30 of immunization value <10 & < 80% of last known value -lazarusN NOt triggering?
  same patient second lab of same before immunization (category 3) 
   same patient with immunization 
 1 patient with encounter with icd9 bronchospasm category 3, icd9 786.07 within 7 days of imm, -klompasD yes
   same patient with encounter with icd9 bronchospasm category 3, icd9 786.07 more than 3 months prior to imm, 
    same patient with immunization  
 1 patient with 2 encounters with icd9 stroke 435.0 within 12 months (NEG) -robertA yes
    same patient with immunization within 30 days prior to second dx (has exclusion)
 1 patient with 1 encounter with meningitis icd9 047.8 within 30 days of immunization (NEG) -maryM yes
      same patient with immunization within 30 days prior to  dx
      same patient with 1 encounter with icd9 within 049.0  more than 12 months prior than first dx
1 patient with 1 encounter with meningitis  321.2 within 30 days of immunization -klompasV NEG yes
      same patient with immunization within 30 days prior to  dx
      same patient with 1 encounter with icd9  049.6 within 12 months than first dx
1 patient with 1 encounter with icd9 not in the list for vaers enc V9.50 (NEG) -spockO  yes or use 728.88
 same patient with immunization within 42 days prior to dx
 same patient with 1 encounter with same icd9 more than 36 months than dx 
1 patient with 1 prescription for medrol-pak  -nickx   NIY
   same patient with immunization within 14 days of rx
1 patient with 1 prescription for benadryl  (NEG) -kruskalS NIY
     same patient with immunization within 7 days of rx
     same patient with 1 prescription for benadryl within past 12 months of rx
1 patient with 1 allergy rabies call category 3 -michaelK  NIY
     same patient with immunization within 42 days of allergy
1 patient with 1 allergy in keyword list in doc lyme call category 3 -bazzaJ  NIY
     same patient with immunization within 42 days of allergy
     same patient with same allergy prior to first allergy 
         
SS
3 patients (should generate 2 cases)
1 patient with 1 encounter with icd9 respiratory code defined in influenza_like_illness from definitions.py
 with temperature >  100.0 set with sites on a non specialty clinic and URGENT CARE  kruskal
1 patient with 1 encounter with icd9 respiratory code and influenza_like_illness defined in ICD9_FEVER_CODES with 
  temperature not recorded set with sites on a non specialty clinic and URGENT CARE alvaroD
1 patient with 1 encounter with icd9 respiratory code defined in influenza_like_illness from definitions.py
 with temperature < 100.0 set with sites on a non specialty clinic and URGENT CARE. NEG platt
1 patient with 1 encounter with icd9 respiratory code and influenza_like_illness defined in ICD9_FEVER_CODES with 
  temperature < 100 set with sites on a non specialty clinic and URGENT CARE  NEG  patricA

LYME
5 patients (should generate 4 cases)
3 patients with an encounter with icd9 code in the lyme_diagnosis 088.81
  1st/3  patient with meds doxycycline within 14 days of diagnosis (lyme2) -platU yes
  2nd/3 patient with meds lyme_other_antibiotics in lyme.py within 14 days of diagnosis (lyme2) -patriciaA yes
  3rd/3 patient only encounter. NEG -alvaroD
1 patient with one test positive lab in 'lyme_igg' or pos  86618-4396 -kruskalu
1 patient with an encounter with icd9 code for rash 782.1 (lyme 3) -danielS yes
 same patient with laborder lyme_elisa within 30 days of diagnosis 
 same patient with med doxycycline within 14 days of diagnosis

pid
2 patients (should generate 2 cases)
1  patient with chlamydia  positive test -deenaF
  same patient with 2 encounters with pid icd9 code 614.2 within 28 days after test
1  patient with  gonorrhea positive test -deenaH
  same patient with 2 encounters with pid icd9 code 099.56 within 28 days before test 
  same patient with encounter for separate patient with encounter with icd9 099.56 after 28 days. NEG

chlamydia
2 patients (should generate 1 cases)
1 patient with chla test positive -deenaF
 same patient with chla test positive after 28 recurrence days 
 same patient with chla test positive within recurrence days (28). NEG
1 patient with chla test negative NEG  -deenaH

syphillis from version 3
5 patients (should generate 3 cases)
1 patient with an encounter with icd9 code for syphilis -kruskal
  same patient with a prescription in syphilis.py within 14 days of encounter
1 patient with encounter with icd9 code for syphilis -spockB
  same patient with prescription for CEFTRIAXONE 2G dose >2g within 14 days  
2 patient with a lab positive for rpr 
1/2 patient a lab positive for ttpa, fta-abs  or tp-igg NEG -donnaP
2/2 patient a lab negative for ttpa, fta-abs  or tp-igg -plattV
1 patient with a lab positive for vrdl -anneI

pertussis
5 patients (should generate 4 cases)
1 patient with an encounter with icd9 code for pertussis 033.9 -deenaF
  same patient with med antibiotic prescription within 7 days of diagnosis
1 patient with an encounter with icd9 code for pertussis 033.0 -deenaH NEG
  same patient with med antibiotic prescription after 7 days of diagnosis
1 patient with lab order of 'pertussis_pcr_order','pertussis_culture_order','pertussis_serology_order' -billx
  same patient with med antibiotic prescription after 7 days of diagnosis
1 patient with positive lab for pertussis_pcr -samuel
1 patient with positive pertussis_culture -whor
       
tb
5 patients (should generate 4 cases)
1 patient with med pyrazinamide -spokb
4 patients with encounter with tb diagnosis 010.00 -018.96
1/4 patient with lab order ('myco' 84460--3836, ) within 14 days after diagnosis -platt
2/4 patient with lab order 'tb' 87556--4598  within 60 before diagnosis  -anneI
3/4 patient with SECONDARY_MED_EVENTS capreomycin'  in TuberculosisDefC class in models.py within 60 days -kruskalu
  same patient with SECONDARY_MED_EVENTS rifabutin' in TuberculosisDefC class in models.py with no diagnosis within 60 days.
4/4 patient with tb lab order afb 87206--3761 after 14 days of dx. NEG - donna

acute hep a
3 patients ( should generate 2 cases)
1 patients with encounter with icd9 for jaundice - deenaw 
 same patient with lab hep a igm positive within 14 days
1 patient with lab alt_2x -spock 
  same  patients patient with lab hep a igm positive within 14 days
1 patient with alt_2x -whop NEG
 same patient with lab igm positive within more than 14 days 

diabetes
17  patients 
 conditions: 
    - Pre-diabetes - (3 posive cases)
    4 patient with no encounters:
    1 patient with lab A1C between 5.7 and 6.4 --MaryA
	1 patient with lab Fasting glucose (FG) between 100 and 125 - johnI
	1 patient with 2 random labs glucose (RG) ≥140 and <200 - donnaG
	1 patient with  2 encounters with icd9 of 250.x1 (frank diabetes) (on the day or before) PlattT 
		same patient with lab A1C between 5.7 and 6.4 (NEG)
    - Frank Diabetes (type 1 and 2)
    8 patients (7 cases)
    1 patient with test A1C with result >= 6.5  - MaryG yes
    1 patient not pregnant  prescription for INSULIN  -KruskalY yes
    1 patient with 2 encounters with icd9 of 250.x1 OR .x3 (type 1) -doolittleO
      same patient with 1 encounter with icd9 of 250.x0 or .x2 (type 2) 
      same patient with prescription of GLUCAGON
      # below should generate type2
    1 patient with 2 encounters with icd9 of 250.x0 or .x2  (type 2)  -whoJ
      same patient with 1 encounter with icd9 of 250.x1 OR .x3 (type 1) 
      # case below is a 50-50 and should generate type 1
    1 patient with 1 encounters with icd9 of 250.x0 or .x2   (type 2)  -whoP
      same patient with 1 encounter with icd9 of 250.x1 OR .x3 (type 1) 
    1 patient with prescription for SITAGLIPTIN  -LazarusN  
    1 patient with lab peptide test <0.8 (type 1)  -bazzaV  
    	same patient with lab test A1C with result >= 6.5
    1 patient with A1C with result < 5.7 NEG -mihaelW
      same patient with 1 encounter of icd9 of 250.x1 OR .x3 (type 1) 
     TODO add case where patient had diabetes before 
      TODO  confirm with mike type 1 : type 2 ICD9s >50% = majority
    - Gestational Diabetes: 
    TODO can someone have frank and gestational? the code in gestational does not filter ones with frank
    5 patient with encounter with icd9 V22.x or V23.x and no edd 
    	1st/5 patient with encounter with icd9 648.8x -susanQ
    	 same patient with prescription containing the term “lancets” or
    	 “test strips” 14 days after encounter icd9 648.8x 
    	2nd/5 patient with lab ogtt 50 fasting  ≥126  -donnaP
    	3rd/5 patient with lab test OGTT 50 random (82950—161) >= 190 -PatriciaI 
    	4th/5 patient with test OGTT 75 1h (82951—2862) >= 180 -doolittleJ  
    	5th/5 patient with test component Positive OGTT 100 fasting urine (cpt 82951-64)
    	  same patient with lab test component Positive OGTT 100 fasting urine (cpt 82951-64) - lazarusY  
 ( make sure that examples have beginning and an end)	
 
Gonorrhea
4 patients (5 cases)
1 patient with test that has a positive lab with gon -kruskal
1 patient with test that has a positive lab with gc -spock
1 patient with 2 lab tests with gon or gc with more than 28 days apart (2pos) -donnaP
1 patient with 2 lab tests with gon or gc with less than 28 days apart (NEG, pos) -anneI

acute hep c
4 patients (4 cases) - using collected date for dates
(c) 1 patient with positive lab for (6 hepatitis c rna) HEP C RNA PCR (QL) 87521--1627 detected - michaelZ
  same patient with labs negative of hep_c_elisa (heb c ab) 86803--217 lab within the prior 12 months
(d) 1 patient with positive lab for (3 hepatitis c elisa) HEPAT C AB 86803--217  reactive -WhoP  
  same patient with labs negative of same lab within the prior 12 months)
(b) 
  1 patient with encounter with jaundice icd9 782.4 - DeenaW  
   same patient with lab hep_c_rna_ detected (6 tests) within 28 days of encounter
   same patient with lab c heb c signal cut off 80074--251 ratio >=3.8 (4 test)  within 28 days
   same patient with lab hep_a_igm_ab non reactive 86705--4329 (7 test no hep a) within 28 days of encounter
   same patient wit lab hep_b_core igm_ab 86705--4870 non reactive ' (8 test no hep b) within 28 days of encounter
  #TODO other negative and positive with other labs to exclude
(a) 1 patient with lab alt 84460--1728 >400 - SpockG  
   same patient with lab hep_c_elisa_ reactive (3 test) within 28 days of alt lab
   same patient with lab (4 test) heb c ab signal cut off  >=3.8
   same patient with (5 test)hep c riba 86804--1867 positive 
   same patient with (6 test) hep c rna HCV PCR QUANT 87522--2352 >1.7
   same patient with hav_tot_neg  80074--213 (11 test)
   same patient with hep_b_surface neg 80055--223 (test 10)
  # TODO other negatives and positive with other labs to exclude
 
acute hep b 
4 patients (4 cases)
(a) 1 patient with jaundice encounter - deenaw yes
 same patient with positive hep_b_igm_ab within 14 days 
(b) 1 patient with lab alt_5x - spockG yes
  same patient with tot bilirubin high >1.5 within 21 days of alt
  same patient with hep b surface positive(confirm) within 21 days of alt
 (c) 1 patient with lab ast 5x -whop yes
   same patient with 2 lab of direct bili and indirect bili, calc bilirubin (d+I) >1.5 within 21 days 
     both tests have to be on the same day.? could they be on same day?
   same patient with hep b viral dna positive(confirm) within 21 days of ast
(d) 1 patient with heb b surface positive -michaelz 
   same patient with hep b surface neg prior 12 months
   same patient with hep b viral dna neg prior 12 months
 1 patient with encounter  with icd9 070.32. NEG -Peter
   same patient with hep b surface positive 
   same patient with hep b surace negative within 12 months
 1 patient with lab with  hep b surface  positive NEG -Marian
   same patient with same hep b surface positive ever 

Giardiasis 
1 patients (1 case)
1 patient with test positve for giard 
1 patient with encounter with icd9 of 787.91?
1 patient with meds metronidazole which value?

