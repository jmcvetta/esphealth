unit test case documentation for esp
author: carolina chacin
updated: dec 12 2011


VAERS (call set rules first one time. save in backup and move after sync db.)
5 patients (should generate 5 cases)	
(all encounters have to be in the non specialty site for urgent care)
1 patient with 1 encounter with a diagnostic in the list of VAERS_DIAGNOSTICS (bells) in rules.py that has an ignore period 12
  same patient with 1 encounter with same diagnostic in the list of VAERS_DIAGNOSTICS 
  that has an ignore period 12 and that happened within the ignore period of above encounter (plat)
  same patient with immunization 60 days prior to first dx 
1 patient with 1 encounter with a diagnostic in the list of VAERS_DIAGNOSTICS (has seizures febrile and rotq) that does not have an ignore period (patri)
   same patient with immunization 60 days prior to dx 
1 patient with 1 lab test in the list of VAERS_LAB_RESULTS that meets the criteria of one defined in rules.py (who r)
 same patient with immunization 60 days prior to lab. 
1 patient with an immunization from table static.vaccine 
  same patient with 1 encounter with fever (temp > 100.4), and set to URGENT CARE 
  within TIME_WINDOW_POST_EVENT (60 days) immunization. (klompas) 
1 patient with 1 encounter with a diagnostic in the list of VAERS_DIAGNOSTIc (guilian barre) 
  that has an ignore period 12 but not in the specialty clinic.  (klruska)
  same patient with immunization within 60 days prior to dx
  #TODO add these cases 2 more patients with 2 more immunizations for them
  #change above cases to be within 42 days
1 patient with platelet count <100 category two (add lab)
1 patient with two labs for hemoglobin where second lab is <10 but > 80% of last known value before immunization, within 42days
  (category 3)
 1 patient with dx bronchospasm category 3, icd9 786.07 within past 3 months, 
 # change code for dx  and brachial neuritis for vaers 3.0 
 # todo another same patient with same diag, but do a neg case where it has bronchospam prior 3 months.

SS
3 patients (should generate 2 cases)
1 patient with 1 encounter with icd9 fever code defined in influenza_like_illness from definitions.py
 with temperature > 100.0 set with sites on a non specialty clinic and URGENT CARE
1 patient with 1 encounter with icd9 fever code and influenza_like_illness defined in ICD9_FEVER_CODES with 
  temperature not recorded set with sites on a non specialty clinic and URGENT CARE
1 patient with 1 encounter with icd9 code defined in influenza_like_illness from definitions.py
 with temperature < 100.0 set with sites on a non specialty clinic and URGENT CARE. NEG
   ??? not ili
1 patient with encounter with an icd9 code that requires fever (see rash icd9 codes in definistions.py) 
defined in OptionalFeverSyndromeHeuristic and an icd9 code of fever or a temperature >100
1 patient with an encounter with icd9 code defined in SyndromeHeuristic (see 'lesions' in definitins.py)


LYME
5 patients (should generate 4 cases)
4 patients with an encounter with icd9 code in the lyme_diagnosis. 
1st/4  patient with meds doxycycline within 14 days of diagnosis (lyme2)
2nd/4 patient with meds lyme_other_antibiotics in lyme.py within 14 days of diagnosis (lyme2)
3rd/4 patient with one test positive lab in 'lyme_elisa', 'lyme_igg', 'lyme_igm', 'lyme_pcr'
   positive within 30 days of diagnosis (lyme1)
4th/4 patient only encounter. NEG
1 patient with an encounter with icd9 code for rash (lyme 3)
same patient with laborder lyme_elisa within 14 days of diagnosis 
same patient with med doxycycline within 14 days of diagnosis

pid
2 patients (should generate 3 cases)
1  patients with chlamydia or gonorrhea positive test  
2 patient with 2 encounters each with icd9 code for pid within 28 days of test
1/2 encounter for one patient with icd9 code for pid after recurring days ??? 28 or 365
2/2 encounter for separate patient with encounter with icd9 code for pid within recurring days. NEG

chlamydia
3 patients (should generate 2 cases)
1 patient with chla test positive
same patient with chlal test positive after recurrence days 
1 patient with chla test negative
1 patient with chla test positive within recurrence days (28). NEG

syphillis from version 3
4 patients (should generate 3 cases)
1 patient with an encounter with icd9 code for syphilis
same patient with a prescription in syphilis.py within 14 days of encounter
2 patient with a lab positive for rpr 
1/2 patient a lab positive for ttpa, fta-abs  or tp-igg
2/2 patient a lab negative for ttpa, fta-abs  or tp-igg . NEG
1 patient with a lab positive for vrdl 

pertussis
3 patients (should generate 3 cases)
2 patient with an encounter with icd9 code for pertussis. one is NEG.
1 patient with a lab order for one of the labs in defs.py
 ( 'pertussis_pcr_order','pertussis_culture_order',  'pertussis_serology_order',)
2 (1 same as encounter, one same as lab) patient with med antibiotic prescription within 7 days of diagnosis
1 patient with positive lab for pertussis_pcr or pertussis_culture
      
tb
6 patients (should generate 4 cases)
1 patient with med pyrazinamide spok 
4 patients with encounter with tb diagnosis
1/4 patient with tb laborder ('myco', 'afb', 'tb', 'tuber',) within 14 days after diagnosis -platt
2/4 patient with lab order of above  within 60 days prior or after diagnosis  -anne
3/4 patient with SECONDARY_MED_EVENTS  (' 'capreomycin', ', ) in TuberculosisDefC class in models.py -kruskalu
4/4 patient with tb lab order after 14 days. NEG 
1 patient with SECONDARY_MED_EVENTS ('rifabutin', ) in TuberculosisDefC class in models.py with no diagnosis. NEG
- donna

acute hep a
3 patients ( should generate 3 cases)
1 patients with encounter with icd9 for jaundice - deena
 same patient with lab hep a igm positive within 14 days
1 patient with lab alt_2x -spock
same  patients patient with lab hep a igm positive within 14 days
same patient with a lab test totbil within 14 days of diagnosis? in code not in spec
1 patient with alt_2x 
 same patient with lab igm positive within more than 14 days

diabetes
17  patients 
 conditions: 
    - Pre-diabetes - (3 posive cases)
    4 patient with no encounters:
    1 patient with lab A1C between 5.7 and 6.4 --MaryA
	1 patient with lab Fasting glucose (FG) between 100 and 125 - johnI
	1 patient with 2 random labs glucose (RG) ≥140 and <200 - donnaG
	1 patient with  2 encounters with icd9 of 250.x1 (frank diabetes) (on the day or before) PlattT 
		same patient with lab A1C between 5.7 and 6.4 (NEG)
    - Frank Diabetes (type 1 and 2)
    8 patients (7 cases)
    1 patient with test A1C with result >= 6.5  - MaryG yes
    1 patient not pregnant  prescription for INSULIN  -KruskalY yes
    1 patient with 2 encounters with icd9 of 250.x1 OR .x3 (type 1) -doolittleO
      same patient with 1 encounter with icd9 of 250.x0 or .x2 (type 2) 
      same patient with prescription of GLUCAGON
      # below should generate type2
    1 patient with 2 encounters with icd9 of 250.x0 or .x2  (type 2)  -whoJ
      same patient with 1 encounter with icd9 of 250.x1 OR .x3 (type 1) 
      # case below is a 50-50 and should generate type 1
    1 patient with 1 encounters with icd9 of 250.x0 or .x2   (type 2)  -whoP
      same patient with 1 encounter with icd9 of 250.x1 OR .x3 (type 1) 
    1 patient with prescription for SITAGLIPTIN  -LazarusN  
    1 patient with lab peptide test <0.8 (type 1)  -bazzaV  
    	same patient with lab test A1C with result >= 6.5
    1 patient with A1C with result < 5.7 NEG -mihaelW
      same patient with 1 encounter of icd9 of 250.x1 OR .x3 (type 1) 
     TODO add case where patient had diabetes before 
      TODO  confirm with mike type 1 : type 2 ICD9s >50% = majority
    - Gestational Diabetes: 
    TODO can someone have frank and gestational? the code in gestational does not filter ones with frank
    5 patient with encounter with icd9 V22.x or V23.x and no edd 
    	1st/5 patient with encounter with icd9 648.8x -susanQ
    	 same patient with prescription containing the term “lancets” or
    	 “test strips” 14 days after encounter icd9 648.8x 
    	2nd/5 patient with lab ogtt 50 fasting  ≥126  -donnaP
    	3rd/5 patient with lab test OGTT 50 random (82950—161) >= 190 -PatriciaI 
    	4th/5 patient with test OGTT 75 1h (82951—2862) >= 180 -doolittleJ  
    	5th/5 patient with test component Positive OGTT 100 fasting urine (cpt 82951-64)
    	  same patient with lab test component Positive OGTT 100 fasting urine (cpt 82951-64) - lazarusY  
    	  
 ( make sure that examples have beginning and an end)	
 
Gonorrhea
4 patients (3 cases)
1 patient with test that has a positive lab with gon
1 patient with test that has a positive lab with gc
1 patient with 2 lab tests with gon or gc with more than 28 days apart
1 patient with 2 lab tests with gon or gc with less than 28 days apart (NEG)

acute hep c
4 patients (4 cases) - using collected date for dates
(c) 1 patient with positive lab for (6 hepatitis c rna) HEP C RNA PCR (QL) 87521--1627 detected - michaelZ
  same patient with labs negative of hep_c_elisa (heb c ab) 86803--217 lab within the prior 12 months
(d) 1 patient with positive lab for (3 hepatitis c elisa) HEPAT C AB 86803--217  reactive -WhoP  good
  same patient with labs negative of same lab within the prior 12 months)
(b) 
  1 patient with encounter with jaundice icd9 782.4 - DeenaW  good
   same patient with lab hep_c_rna_ detected (6 tests) within 28 days of encounter
   same patient with lab c heb c signal cut off 80074--251 ratio >=3.8 (4 test)  within 28 days
   same patient with lab hep_a_igm_ab non reactive 86705--4329 (7 test no hep a) within 28 days of encounter
   same patient wit lab hep_b_core igm_ab 86705--4870 non reactive ' (8 test no hep b) within 28 days of encounter
  #TODO other negative and positive with other labs to exclude
(a) 1 patient with lab alt 84460--1728 >400 - SpockG  good
   same patient with lab hep_c_elisa_ reactive (3 test) within 28 days of alt lab
   same patient with lab (4 test) heb c ab signal cut off  >=3.8
   same patient with (5 test)hep c riba 86804--1867 positive 
   same patient with (6 test) hep c rna HCV PCR QUANT 87522--2352 >1.7
   same patient with hav_tot_neg  80074--213 (11 test)
   same patient with hep_b_surface neg 80055--223 (test 10)
  # TODO other negatives and positive with other labs to exclude
 
acute hep b -- only partially done based on code comment, need to corroborate with spec.
4 patients (4 cases)
#TODO add more negative and positive for the ors
(a) 1 patient with jaundice encounter - deenaw
 same patient with positive hep_b_igm_ab within 14 days 
(b) 1 patient with lab alt_5x - spockG
  same patient with tot bilirubin high >1.5 within 21 days of alt
  same patient with hep b surface positive(confirm) within 21 days of alt
 (c) 1 patient with lab ast 5x -whop
   same patient with 2 lab of direct bili and indirect bili, calc bilirubin (d+I) >1.5 within 21 days
   same patient with hep b viral dna positive(confirm) within 21 days of ast
(d) 1 patient with heb b surface positive -michaelz
   same patient with hep b surface neg prior 12 months
   same patient with hep b viral dna neg prior 12 months

Giardiasis
